# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨Makefile

# ãƒ­ãƒ¼ã‚«ãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è‡ªå‹•å–å¾—
LOCAL_IP := $(shell route -n get default | grep interface | awk '{print $$2}' | xargs ifconfig | grep "inet " | head -1 | awk '{print $$2}')

.PHONY: env build-ios-dev build-android-dev build-ios-prd submit-ios help

# .env.localãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼‰
env:
	@echo "ğŸ”§ .env.localãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªä¸­..."
	@if [ -f .env.local ]; then \
		echo "ğŸ“„ æ—¢å­˜ã®.env.localãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚"; \
		echo "ğŸ“ ç¾åœ¨ã®è¨­å®š:"; \
		cat .env.local; \
		echo ""; \
		echo "ğŸ”„ ã‚µãƒ¼ãƒãƒ¼è¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ä¸Šæ›¸ãä¸­..."; \
		sed -i '' 's/^EXPO_PUBLIC_SERVER_IP=.*/EXPO_PUBLIC_SERVER_IP=$(LOCAL_IP)/' .env.local; \
		echo "âœ… ã‚µãƒ¼ãƒãƒ¼è¨­å®šãŒä¸Šæ›¸ãã•ã‚Œã¾ã—ãŸ:"; \
		cat .env.local; \
	else \
		echo "ğŸ“„ æ–°ã—ã„.env.localãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆä¸­..."; \
		echo "EXPO_PUBLIC_SERVER_IP=$(LOCAL_IP)" > .env.local; \
		echo "âœ… .env.localãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ:"; \
		cat .env.local; \
	fi

# EAS Buildã‚³ãƒãƒ³ãƒ‰ï¼ˆexpo.devã®ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•å‚ç…§ï¼‰
build-ios-dev:
	@echo "ğŸ iOS Development Buildã‚’ä½œæˆä¸­..."
	eas build --platform ios --profile development

build-android-dev:
	@echo "ğŸ¤– Android Development Buildã‚’ä½œæˆä¸­..."
	eas build --platform android --profile development

build-ios-prd:
	@echo "ğŸ iOS Production Buildã‚’ä½œæˆä¸­..."
	eas build --platform ios --profile production

submit-ios:
	@echo "ğŸ iOS Production Buildã‚’é€ä¿¡ä¸­..."
	eas submit --platform ios --profile production

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
help:
	@echo "åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:"
	@echo "  make env            - .env.localãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª/ç”Ÿæˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼è¨­å®šï¼‰"
	@echo ""
	@echo "EAS Buildï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã§ãƒ“ãƒ«ãƒ‰ã€expo.devã®ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•å‚ç…§ï¼‰:"
	@echo "  make build-ios-dev    - iOS Development Buildä½œæˆ"
	@echo "  make build-android-dev - Android Development Buildä½œæˆ"
	@echo "  make build-ios-prd    - iOS Production Buildä½œæˆ"
	@echo "  make submit-ios       - iOS Production Buildé€ä¿¡"
	@echo ""
	@echo "ç’°å¢ƒå¤‰æ•°:"
	@echo "  LOCAL_IP        - è‡ªå‹•å–å¾—ã•ã‚ŒãŸãƒ­ãƒ¼ã‚«ãƒ«IP: $(LOCAL_IP)"
